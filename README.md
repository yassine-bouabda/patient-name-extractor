# French Medical Document Name Extractor API

A FastAPI service for extracting patient names from French medical documents using simple heuristics.

## Name Extraction Logic

### Detection Strategy Hierarchy

#### 1. **Prefix Detection** (Highest Priority) 
Doctors in general use formal wording. In France, it follows a simple pattern. This heuristic works well when the patient name is embedded in the text body.
```
Pattern: [Prefix] [FirstName] [FAMILYNAME]
Examples: 
- "Monsieur Jean DUPONT"
- "Madame Marie BERNARD" 
- "Mme Claire ROUSSEAU"
```

#### 2. **Keyword Detection** (Secondary Priority)
Another pattern is where the medical document is generated by a computer system. The names follow a keyword like patient, name, etc.
```
Separate Keywords:
- "Nom: MARTIN" + "Prénom: Pierre" → Pierre MARTIN
- "patient: Jean DUPONT" → Jean DUPONT

Combined Patterns:
- "patient Jean DUPONT" → Jean DUPONT
```

**Note:** These 2 rules will be able to cover general cases but might fail in cases where doctors don't use a formal prefix or when the name is at the top of the file like in image 1.

### Validation:
- To provide a certain level of validation, I used pydantic base model to validate document format
- I also used a validator to validate names (uppercase family name and first letter capitalized)

### Customization
Heuristics need fine-tuning, so I provided a config class that allows customization of the solution:
```python
@dataclass
class NameExtractorConfig:
    offset_next_line: int = 5
    sort_document: bool = True
    name_prefixes: Set[str]
    nom_keywords: Set[str] 
    prenom_keywords: Set[str]
    patient_keywords: Set[str]
```

## API Test

### POST `/extract-patient`
Extracts patient names from uploaded JSON documents.

**Request:**
```bash
curl -X POST "http://localhost:8000/extract-patient" -F "file=@data/sample_doc.json;type=application/json"
```

**Response:**
```json
{
  "success": true,
  "document_id": null,
  "patient_name": {
    "first_name": "Jean",
    "family_name": "DUPONT"
  }
}
```

## Best Practices Implementation
- Async Architecture 
- Pydantic Validation 
- Unit Testing 

### Test Execution
```bash
# Run all tests
uv run pytest . -v
```

## Potential Improvements

### 1. **Message Queue Integration**

- **Batch Processing:** Handle multiple documents efficiently
- **Reliability:** Job persistence and retry mechanisms

```bash
Producer (FastAPI) → Redis Queue → Celery Workers → Results
```

### 2. **Rust Instead of Python**
The heuristics are simple, and this solution will be used as a baseline. It might be a good idea to use a low-level language like Rust.

### 3. **Improve Serving**
- Use load balancer 
- Replace uvicorn with a production ASGI server like Gunicorn

### Disclaimer
- I used AI to help generate tests 
- I also used auto-completion and correction in my IDE 